<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gia Ph·∫£ H·ªç L√™ C√¥ng - Qu·∫£n l√Ω</title>
    
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../tree.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="dashboard-page">
    <header class="header">
        <div class="header-container">
            <div class="header-left">
                <div class="logo"><i class="fas fa-sitemap"></i></div>
                <div class="header-info">
                    <h1>Gia Ph·∫£ H·ªç L√™ C√¥ng</h1>
                    <p class="user-role" id="userRole">Qu·∫£n tr·ªã vi√™n</p>
                </div>
            </div>
            <div class="header-right">
                <span class="user-name" id="userName">Admin</span>
                <button class="btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</button>
            </div>
        </div>
    </header>

    <div class="tabs-container" id="mainTabs">
        <button class="tab-btn active" data-target="#dashboard-tab"><i class="fas fa-chart-line"></i> Dashboard</button>
        <button class="tab-btn" data-target="#tree-tab"><i class="fas fa-sitemap"></i> C√¢y Gia ph·∫£</button>
        <button class="tab-btn" data-target="#members-tab"><i class="fas fa-users"></i> Th√†nh vi√™n</button>
        <button class="tab-btn" data-target="#posts-tab"><i class="fas fa-newspaper"></i> B√†i vi·∫øt</button>
        <button class="tab-btn" data-target="#settings-tab"><i class="fas fa-cog"></i> C√†i ƒë·∫∑t</button>
    </div>

    <div class="main-content">
        <div id="dashboard-tab" class="tab-content active">
            <div id="stats-content-wrapper">
                </div>
        </div>

        <div id="tree-tab" class="tab-content">
            <div class="tree-controls" style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                <div class="search-box" style="position: relative;">
                    <input type="text" id="tree-search-input" placeholder="T√¨m ng∆∞·ªùi tr√™n c√¢y...">
                    <div id="tree-search-results" class="search-results-dropdown"></div>
                </div>
                </div>
            <div class="tree-section">
                <div id="tree-canvas"></div>
            </div>
        </div>

        <div id="members-tab" class="tab-content">
            <div class="members-header">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="member-search-input" placeholder="T√¨m ki·∫øm th√†nh vi√™n...">
                </div>
                <button class="btn-add" onclick="openAddModal()">+ Th√™m Th√†nh vi√™n</button>
            </div>
            <div class="members-grid" id="membersGrid"></div>
        </div>

        <div id="posts-tab" class="tab-content">
            <div class="tree-section">
                <div class="members-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; font-size: 20px; color: var(--primary-color);">üì¢ B√†i vi·∫øt & Th√¥ng B√°o</h2>
                    <button class="btn-add" onclick="openCreatePostModal()">+ Vi·∫øt b√†i m·ªõi</button>
                </div>
                <div id="posts-list-container" class="posts-grid">
                    </div>
            </div>
        </div>

        <div id="settings-tab" class="tab-content">
            <div id="settings-content-wrapper">
                </div>
        </div>
    </div>

    <div id="add-member-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Th√¥ng tin th√†nh vi√™n</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="member-form" onsubmit="event.preventDefault(); saveMember();">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="m-name">H·ªç v√† t√™n</label>
                        <input type="text" id="m-name" required placeholder="VD: L√™ C√¥ng A">
                    </div>
                    <div class="form-group">
                        <label for="m-gender">Gi·ªõi t√≠nh</label>
                        <select id="m-gender">
                            <option value="Nam">Nam</option>
                            <option value="N·ªØ">N·ªØ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="m-birth">Ng√†y sinh</label>
                        <input type="text" id="m-birth" placeholder="DD/MM/YYYY ho·∫∑c YYYY">
                    </div>
                    <div class="form-group">
                        <label for="m-death">Ng√†y m·∫•t (n·∫øu c√≥)</label>
                        <input type="text" id="m-death" placeholder="ƒê·ªÉ tr·ªëng n·∫øu c√≤n s·ªëng">
                    </div>
                    
                    <div class="form-group">
                        <label for="m-fid">Cha (n·∫øu c√≥)</label>
                        <select id="m-fid"></select> </div>
                    <div class="form-group">
                        <label for="m-mid">M·∫π (n·∫øu c√≥)</label>
                        <select id="m-mid"></select>
                    </div>
                    <div class="form-group">
                        <label for="m-pid">V·ª£ / Ch·ªìng (n·∫øu c√≥)</label>
                        <select id="m-pid"></select>
                    </div>
                </div>
                
                <div class="modal-footer" style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
                    <button type="button" id="btn-delete-member" class="btn-delete" onclick="deleteMember()" style="display: none; background: #ef4444; color: white;">X√≥a</button>
                    <button type="button" class="btn-cancel" onclick="closeModal()">H·ªßy</button>
                    <button type="submit" class="btn-save">L∆∞u d·ªØ li·ªáu</button>
                </div>
            </form>
        </div>
    </div>

    <div id="post-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="post-modal-title">Vi·∫øt b√†i m·ªõi</h2>
                <span class="close" onclick="closePostModal()">&times;</span>
            </div>
            <div class="form-group">
                <label for="post-title">Ti√™u ƒë·ªÅ b√†i vi·∫øt</label>
                <input type="text" id="post-title" class="form-input" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ...">
            </div>
            <div class="form-group">
                <label for="post-category">Th·ªÉ lo·∫°i</label>
                <select id="post-category" class="form-input">
                    <option value="announcement">Th√¥ng b√°o</option>
                    <option value="event">S·ª± ki·ªán</option>
                    <option value="news">Tin t·ª©c</option>
                </select>
            </div>
            <div class="form-group">
                <label for="post-content">N·ªôi dung chi ti·∫øt</label>
                <textarea id="post-content" rows="8" class="form-input" placeholder="Vi·∫øt n·ªôi dung v√†o ƒë√¢y..."></textarea>
            </div>
            <div class="form-group" style="display: flex; align-items: center; gap: 8px;">
                <input type="checkbox" id="post-pinned" style="width: 18px; height: 18px;">
                <label for="post-pinned" style="margin: 0; cursor: pointer;">Ghim b√†i vi·∫øt n√†y l√™n ƒë·∫ßu</label>
            </div>
            <div class="modal-footer" style="margin-top: 20px; text-align: right;">
                <button class="btn-cancel" onclick="closePostModal()" style="margin-right: 10px;">H·ªßy</button>
                <button class="btn-save" onclick="savePost()">L∆∞u b√†i vi·∫øt</button>
            </div>
        </div>
    </div>

    <div id="import-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <h2>Nh·∫≠p d·ªØ li·ªáu t·ª´ file CSV</h2>
            <div class="import-container" style="padding: 20px; border: 2px dashed #ccc; text-align: center; border-radius: 8px;">
                <input type="file" id="csv-file-input" accept=".csv" style="display: none;" onchange="updateFileName(this)">
                <label for="csv-file-input" style="cursor: pointer; color: #3498db;">
                    <i class="fas fa-file-upload" style="font-size: 40px; margin-bottom: 10px;"></i>
                    <p id="file-name-display">Ch·ªçn t·ªáp .csv t·ª´ m√°y t√≠nh</p>
                </label>
            </div>
            <div id="import-status" style="margin-top: 15px; font-size: 14px;"></div>
            <div class="modal-footer" style="margin-top: 20px; text-align: right;">
                <button class="btn-cancel" onclick="document.getElementById('import-modal').style.display='none'">ƒê√≥ng</button>
                <button id="btn-upload-csv" class="btn-save" onclick="handleFileUpload()" disabled>T·∫£i l√™n & X·ª≠ l√Ω</button>
            </div>
        </div>
    </div>

    <button id="btn-back-to-top" onclick="scrollToTop()" title="L√™n ƒë·∫ßu trang"><i class="fas fa-chevron-up"></i></button>

    <script src="js/renderer.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
